<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>JusMobile</title>

    <link rel="icon" href="images/icons/icon-32x32.png">

    <link rel="manifest" href="/manifest.json">
    <!-- Add to home screen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="JusMobile">
    <link rel="apple-touch-icon" href="images/icons/icon-152x152.png">
    <meta name="msapplication-TileImage" content="images/icons/icon-144x144.png">
    <meta name="msapplication-TileColor" content="#2F3BA2">

    <script src="https://www.gstatic.com/firebasejs/4.10.0/firebase.js"></script>

    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>

    <!--===============================================================================================-->
    	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
    <!--===============================================================================================-->
    	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
    <!--===============================================================================================-->
    	<link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
    <!--===============================================================================================-->
    	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
    <!--===============================================================================================-->
    	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
    <!--===============================================================================================-->
    	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
    <!--===============================================================================================-->
    	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
    <!--===============================================================================================-->
    	<link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css">
    <!--===============================================================================================-->

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <link rel="stylesheet" type="text/css" href="css/util.css">

  </head>

  <body>
    <header class="header">
      <i class="fas fa-bars" onclick="openLeftMenu()"></i>
    </header>


    <main class="main" style="margin-top: 60px" >

      <div id="videos" class="container">
        <div class="row"></div>
      </div>

      <!-- WATCH VIDEO CONTAINER -->
      <div id="watch-video-container"class="dialog-container">
        <div class="dialog">
          <div class="dialog-buttons">
            <button id="butCloseVideo" class="button">Cancel</button>
          </div>

          <!-- <div class="dialog-title">Nome do Video</div> -->
          <div class="embed-responsive embed-responsive-16by9 m-b-20">
            <iframe id="videoSrc" class="embed-responsive-item"   webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
          </div>

        </div>
      </div>

      <script src="http://vjs.zencdn.net/6.6.3/video.js"></script>

    </main>

    <div class="w3-sidebar w3-bar-block w3-card w3-animate-left" style="display:none" id="leftMenu">
      <button onclick="closeLeftMenu()" class="w3-bar-item w3-button w3-large">Close &times;</button>
      <a onclick="logOutUser()"  class="w3-bar-item w3-button">Log Out</a>
      <!-- <a onclick="goToAdmin()"  class="w3-bar-item w3-button">Administração</a> -->

    </div>

    <!--===============================================================================================-->
    	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
    <!--===============================================================================================-->
    	<script src="vendor/animsition/js/animsition.min.js"></script>
    <!--===============================================================================================-->
    	<script src="vendor/bootstrap/js/popper.js"></script>
    	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <!--===============================================================================================-->
    	<script src="vendor/select2/select2.min.js"></script>
    <!--===============================================================================================-->
    	<script src="vendor/daterangepicker/moment.min.js"></script>
    	<script src="vendor/daterangepicker/daterangepicker.js"></script>
    <!--===============================================================================================-->
    	<script src="vendor/countdowntime/countdowntime.js"></script>
    <!--===============================================================================================-->
    <script src="js/main.js"></script>
    <script src="js/moment-with-locales.min.js"></script>
    <script src="js/firebase.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
      });

      firebase.initializeApp(config);


      firebase.auth().onAuthStateChanged(user => {
        if(user) {
          showAdminPart(user)

        }else{
          goToSignIn()
        }
      });

      function showAdminPart(user) {
        firebase.database().ref('users/' + user.uid ).once('value')
        .then(function(snapshot) {
          if(snapshot.val().admin){
            var buttonAdmin = '<a onclick="goToAdmin()"  class="w3-bar-item w3-button">Administração</a>'
            $("#leftMenu").append(buttonAdmin);
          }else{

          }
          //console.log(snapshot.val().admin);
        }, function(error) {
          // The Promise was rejected.
          console.error(error);
        });
      }

      function openLeftMenu() {
        document.getElementById("leftMenu").style.display = "block";
      }
      function closeLeftMenu() {
        document.getElementById("leftMenu").style.display = "none";
      }

      function logOutUser() {
        console.log('Service Worker Registered')
        firebase.auth().signOut();
      }

      function getData(){

        firebase.database().ref("/videos").on("value", function(snapshot) {
            // location.reload();
            // console.log("changed");
            $( ".col-md-4" ).remove();
            snapshot.forEach(function(childSnapshot) {
              // key
              var key = childSnapshot.key;
              // value, could be object
              var childData = childSnapshot.val();
              // Do what you want with these key/values here

              var card = '<div class="col-md-4"><div class="card" onclick="toggleAddDialogWatchVideo(true, ' + childData.url + ')"><img src="' + childData.thumbnail + '" alt="Avatar" style="width:100%; height: 200px;">'
              var cardContainer = '<div class="container"> <h4 class="video-author-name"> <b>'+ childData.author + '</b> </h4> <p>' + childData.description +'</p> <p class="video-date-published">' + childData.datePublish + '</p> </div>'
              var endDiv = '</div> </div>'
              html = card + cardContainer + endDiv

              $(".row").append(html);

            });
        });
      }



      document.getElementById('butCloseVideo').addEventListener('click', function() {
        // Close the add new city dialog
        toggleAddDialogWatchVideo(false, );
      });

      window.onload = function(){
        getData()
      };

    </script>
  </body>
</html>
